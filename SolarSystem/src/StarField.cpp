// ============================================================================
// ملف StarField.cpp - تنفيذ كلاس حقل النجوم
// ============================================================================
// هذا الملف يحتوي على جميع الدوال التي تنفذ رسم النجوم في الخلفية
// النجوم تُرسم كخلفية ثابتة للمحاكاة
// ============================================================================

// تضمين ملف تعريف كلاس حقل النجوم
#include "../include/StarField.h"

// تضمين مكتبة OpenGL للرسومات ثلاثية الأبعاد
#include <GL/glut.h>

// تضمين مكتبة الرياضيات للدوال الرياضية
#include <math.h>

// تضمين مكتبة الوظائف العامة (للأرقام العشوائية)
#include <stdlib.h>

// ============================================================================
// ثوابت رياضية
// ============================================================================

// ثابت رياضي لقيمة π (باي) بدقة عالية
const float M_PI_CONST = 3.14159265358979323846f;

// ============================================================================
// دالة البناء Constructor - تقوم بإنشاء حقل نجوم جديد
// ============================================================================
// هذه الدالة تستدعى عند إنشاء كائن StarField
// تقوم بتهيئة النجوم تلقائياً
// ============================================================================
StarField::StarField() {
    // استدعاء دالة التهيئة لإنشاء النجوم
    init();
}

// ============================================================================
// دالة التهيئة - إنشاء مواقع النجوم عشوائياً
// ============================================================================
// هذه الدالة تستدعى مرة واحدة لتهيئة مواقع النجوم
// تقوم بإنشاء مواقع عشوائية للنجوم في الفضاء ثلاثي الأبعاد
// ============================================================================
void StarField::init() {
    // المرور على كل نجم في المصفوفة
    for (int i = 0; i < NUM_STARS; i++) {
        // ====================================================================
        // حساب الموضع باستخدام الإحداثيات الكروية (Spherical Coordinates)
        // ====================================================================
        
        // زاوية الأفق (Theta) - من 0 إلى 360 درجة
        // rand() % 360: رقم عشوائي من 0 إلى 359
        // تحويل من درجات إلى راديان
        float theta = (rand() % 360) * M_PI_CONST / 180.0f;
        
        // زاوية الارتفاع (Phi) - من 0 إلى 180 درجة
        // rand() % 180: رقم عشوائي من 0 إلى 179
        // تحويل من درجات إلى راديان
        float phi = (rand() % 180) * M_PI_CONST / 180.0f;
        
        // نصف القطر (Radius) - المسافة من المركز
        // 80.0f + (rand() % 40): رقم عشوائي من 80 إلى 119
        // النجوم موزعة على مسافات مختلفة
        float radius = 80.0f + (rand() % 40);
        
        // ====================================================================
        // تحويل من الإحداثيات الكروية إلى الإحداثيات الديكارتية
        // ====================================================================
        
        // الموضع X = radius * sin(phi) * cos(theta)
        stars[i][0] = radius * sin(phi) * cos(theta);
        
        // الموضع Y = radius * sin(phi) * sin(theta)
        stars[i][1] = radius * sin(phi) * sin(theta);
        
        // الموضع Z = radius * cos(phi)
        stars[i][2] = radius * cos(phi);
    }
}

// ============================================================================
// دالة الرسم - رسم جميع النجوم
// ============================================================================
// هذه الدالة تستدعى في كل إطار لرسم النجوم
// time: الوقت الحالي في المحاكاة (للتأثيرات المتحركة)
// ============================================================================
void StarField::draw(float time) {
    // إيقاف الإضاءة لرسم النجوم بلون ثابت (بدون تأثيرات الإضاءة)
    glDisable(GL_LIGHTING);
    
    // تعيين حجم النقطة (البكسل) للنجوم
    glPointSize(1.5f);  // 1.5 بكسل = حجم صغير للنجوم
    
    // بدء رسم النقاط (GL_POINTS)
    glBegin(GL_POINTS);
    
    // المرور على كل نجم في المصفوفة
    for (int i = 0; i < NUM_STARS; i++) {
        // حساب سطوع النجم بشكل متذبذب باستخدام دالة sin
        // هذا يعطي تأثير الوميض للنجوم
        // 0.7f: الحد الأدنى للسطوع (70%)
        // 0.3f: مقدار التذبذب (30%)
        // time * 2.0f: سرعة التذبذب
        // i * 0.1f: إزاحة لكل نجم للحصول على تذبذبات مختلفة
        float brightness = 0.7f + 0.3f * sin(time * 2.0f + i * 0.1f);
        // السطوع يتذبذب بين 0.7 و 1.0
        
        // تعيين لون النجم (رمادي بسطوع متغير)
        // RGB: (brightness, brightness, brightness) = لون رمادي
        glColor3f(brightness, brightness, brightness);
        
        // رسم النجم في موضعه
        glVertex3fv(stars[i]);  // رسم النقطة في الموضع المحفوظ
    }
    
    // إنهاء رسم النقاط
    glEnd();
    
    // إعادة تفعيل الإضاءة للعناصر الأخرى
    glEnable(GL_LIGHTING);
}
