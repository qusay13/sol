// ============================================================================
// ملف Camera.cpp - تنفيذ كلاس الكاميرا
// ============================================================================
// هذا الملف يحتوي على جميع الدوال التي تنفذ سلوك الكاميرا في المحاكاة
// يتضمن التحكم في موضع الكاميرا والتركيز على الكواكب والتصغير
// ============================================================================

// تضمين ملف تعريف كلاس الكاميرا (يحتوي على تعريفات المتغيرات والدوال)
#include "../include/Camera.h"

// ============================================================================
// دالة البناء Constructor - تقوم بإنشاء كاميرا جديدة
// ============================================================================
// هذه الدالة تستدعى عند إنشاء كائن كاميرا جديد
// تقوم بتهيئة جميع المتغيرات بالقيم الافتراضية
// ============================================================================
Camera::Camera() 
    // قائمة التهيئة: تهيئة المتغيرات مباشرة قبل دخول جسم الدالة
    : distance(50.0f),          // المسافة الافتراضية من المركز (50 وحدة)
      angleX(20.0f),            // زاوية الميل العمودي الافتراضية (20 درجة)
      angleY(0.0f),             // زاوية الدوران الأفقي الافتراضية (0 درجة)
      lastMouseX(0),            // آخر موضع X للماوس (للتتبع)
      lastMouseY(0),            // آخر موضع Y للماوس (للتتبع)
      mousePressed(false),      // حالة الضغط على الماوس (false = غير مضغوط)
      focusedPlanet(-2),        // الكوكب المُركز عليه (-2 = لا يوجد تركيز، -1 = الشمس، 0-8 = الكواكب)
      focusDistance(15.0f),     // المسافة عند التركيز على كوكب (15 وحدة)
      autoRotate(false)         // الدوران التلقائي (false = غير مفعّل)
{}

// ============================================================================
// دوال Getter - لإرجاع قيم خصائص الكاميرا
// ============================================================================
// هذه الدوال تسمح بالوصول إلى القيم الخاصة (private) من خارج الكلاس
// ============================================================================

// إرجاع المسافة الحالية من المركز
float Camera::getDistance() const { return distance; }

// إرجاع زاوية الميل العمودي (بالدرجات)
float Camera::getAngleX() const { return angleX; }

// إرجاع زاوية الدوران الأفقي (بالدرجات)
float Camera::getAngleY() const { return angleY; }

// إرجاع رقم الكوكب المُركز عليه (-2 = لا يوجد، -1 = الشمس، 0-8 = الكواكب)
int Camera::getFocusedPlanet() const { return focusedPlanet; }

// إرجاع المسافة عند التركيز على كوكب
float Camera::getFocusDistance() const { return focusDistance; }

// إرجاع حالة الدوران التلقائي (true = مفعّل، false = غير مفعّل)
bool Camera::getAutoRotate() const { return autoRotate; }

// ============================================================================
// دوال Setter - لتعيين قيم خصائص الكاميرا
// ============================================================================
// هذه الدوال تسمح بتعديل القيم الخاصة (private) من خارج الكلاس
// ============================================================================

// تعيين المسافة من المركز
void Camera::setDistance(float d) { distance = d; }

// تعيين زاوية الميل العمودي
void Camera::setAngleX(float a) { angleX = a; }

// تعيين زاوية الدوران الأفقي
void Camera::setAngleY(float a) { angleY = a; }

// تعيين الكوكب المُركز عليه
void Camera::setFocusedPlanet(int p) { focusedPlanet = p; }

// تعيين المسافة عند التركيز على كوكب
void Camera::setFocusDistance(float d) { focusDistance = d; }

// تبديل حالة الدوران التلقائي (من true إلى false أو العكس)
void Camera::toggleAutoRotate() { autoRotate = !autoRotate; }

// ============================================================================
// دالة التصغير (Zoom In) - تقريب الكاميرا
// ============================================================================
// هذه الدالة تقوم بتقريب الكاميرا (تقليل المسافة)
// amount: مقدار التصغير (كلما زاد كلما اقتربنا أكثر)
// ============================================================================
void Camera::zoomIn(float amount) {
    if (focusedPlanet == -1) {  // إذا كان التركيز على الشمس
        // تقليل المسافة عند التركيز على الشمس
        focusDistance -= amount;
        // تحديد حد أدنى للمسافة (8 وحدات) لمنع الاقتراب الشديد
        if (focusDistance < 8.0f) focusDistance = 8.0f;
    } else {  // إذا كان التركيز على كوكب آخر أو لا يوجد تركيز
        // تقليل المسافة العامة
        distance -= amount;
        // تحديد حد أدنى للمسافة (5 وحدات) لمنع الاقتراب الشديد
        if (distance < 5.0f) distance = 5.0f;
    }
}

// ============================================================================
// دالة التكبير (Zoom Out) - إبعاد الكاميرا
// ============================================================================
// هذه الدالة تقوم بإبعاد الكاميرا (زيادة المسافة)
// amount: مقدار التكبير (كلما زاد كلما ابتعدنا أكثر)
// ============================================================================
void Camera::zoomOut(float amount) {
    if (focusedPlanet == -1) {  // إذا كان التركيز على الشمس
        // زيادة المسافة عند التركيز على الشمس
        focusDistance += amount;
        // تحديد حد أقصى للمسافة (50 وحدة) لمنع الابتعاد الشديد
        if (focusDistance > 50.0f) focusDistance = 50.0f;
    } else {  // إذا كان التركيز على كوكب آخر أو لا يوجد تركيز
        // زيادة المسافة العامة
        distance += amount;
        // تحديد حد أقصى للمسافة (100 وحدة) لمنع الابتعاد الشديد
        if (distance > 100.0f) distance = 100.0f;
    }
}

// ============================================================================
// دالة بدء السحب (Start Drag) - بدء سحب الكاميرا بالماوس
// ============================================================================
// هذه الدالة تستدعى عند الضغط على زر الماوس
// x, y: موضع الماوس الحالي (بالبكسل)
// ============================================================================
void Camera::startDrag(int x, int y) {
    mousePressed = true;    // تعيين حالة الضغط على الماوس إلى true
    lastMouseX = x;         // حفظ موضع X الحالي للماوس
    lastMouseY = y;         // حفظ موضع Y الحالي للماوس
    autoRotate = false;     // إيقاف الدوران التلقائي عند بدء السحب
}

// ============================================================================
// دالة إيقاف السحب (Stop Drag) - إيقاف سحب الكاميرا
// ============================================================================
// هذه الدالة تستدعى عند رفع زر الماوس
// ============================================================================
void Camera::stopDrag() {
    mousePressed = false;   // تعيين حالة الضغط على الماوس إلى false
}

// ============================================================================
// دالة السحب (Drag) - تحديث موضع الكاميرا أثناء السحب
// ============================================================================
// هذه الدالة تستدعى عند تحريك الماوس أثناء الضغط
// x, y: موضع الماوس الحالي (بالبكسل)
// ============================================================================
void Camera::drag(int x, int y) {
    if (mousePressed) {  // إذا كان الماوس مضغوطاً
        // حساب الفرق في موضع الماوس (الحركة)
        float dx = x - lastMouseX;  // الفرق في الاتجاه الأفقي
        float dy = y - lastMouseY;  // الفرق في الاتجاه العمودي
        
        // تحديث زاوية الدوران الأفقي بناءً على الحركة الأفقية
        // 0.5f = حساسية الدوران (كلما قل كلما كان الدوران أبطأ)
        angleY += dx * 0.5f;
        
        // تحديث زاوية الميل العمودي بناءً على الحركة العمودية
        angleX += dy * 0.5f;
        
        // تحديد حد أقصى لزاوية الميل العمودي (89 درجة)
        // لمنع قلب الكاميرا رأساً على عقب
        if (angleX > 89.0f) angleX = 89.0f;
        
        // تحديد حد أدنى لزاوية الميل العمودي (-89 درجة)
        if (angleX < -89.0f) angleX = -89.0f;
        
        // حفظ موضع الماوس الحالي للاستخدام في المرة القادمة
        lastMouseX = x;
        lastMouseY = y;
    }
}

// ============================================================================
// دالة التحقق من حالة الضغط على الماوس
// ============================================================================
// هذه الدالة ترجع true إذا كان الماوس مضغوطاً، و false إذا لم يكن
// ============================================================================
bool Camera::isMousePressed() const { 
    return mousePressed;  // إرجاع حالة الضغط على الماوس
}
